<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Lipee - Pro Slot Control V10</title>
    <style>
        body { background: #050505; margin: 0; font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; }
        
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #111 0%, #000 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999;
        }

        .splash-logo { font-size: 3rem; font-weight: bold; color: #00FF00; text-shadow: 0 0 30px #00FF00; margin-bottom: 30px; text-align: center; }

        #main-app { display: none; flex-direction: column; align-items: center; height: 100vh; padding: 10px; }
        
        #controls {
            background: rgba(10, 10, 10, 0.98); padding: 12px; border-radius: 12px;
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
            border: 1px solid #333; margin-bottom: 10px; width: 98%;
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.15);
        }

        .config-group { background: #1a1a1a; padding: 6px 12px; border-radius: 8px; border: 1px solid #444; display: flex; align-items: center; gap: 8px; font-size: 11px; }

        #map-container { position: relative; border: 2px solid #222; line-height: 0; background: #000; overflow: hidden; cursor: crosshair; }
        #game-map { filter: brightness(0.2) contrast(1.3); max-width: 100%; max-height: 75vh; }
        #drawing-canvas { position: absolute; top: 0; left: 0; pointer-events: none; }

        button { padding: 10px 15px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 11px; text-transform: uppercase; }
        .btn-play { background: #00FF00; color: #000; box-shadow: 0 0 15px #00FF00; }
        .btn-undo { background: #ffcc00; color: #000; }
        .btn-clear { background: #ff4444; color: #fff; }
        .btn-save { background: #00d4ff; color: #000; }
        
        /* Switch Custom */
        .switch { position: relative; display: inline-block; width: 34px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 20px; border: 1px solid #555; }
        .slider:before { position: absolute; content: ""; height: 12px; width: 12px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #ff4400; }
        input:checked + .slider:before { transform: translateX(14px); }

        /* Checkbox do Slot */
        .slot-visible { width: 18px; height: 18px; accent-color: #00FF00; cursor: pointer; }

        input[type=range] { cursor: pointer; accent-color: #00FF00; }
        input[type=text], select { background: #111; color: #fff; border: 1px solid #444; padding: 5px; border-radius: 4px; font-size: 12px; }
        label { font-weight: bold; color: #00FF00; font-size: 10px; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="splash-logo">COACH LIPEE<br><span style="font-size: 1rem; color: #fff; letter-spacing: 3px;">SLOT CONTROL & HEATMAP V10</span></div>
        <button class="btn-play" style="padding: 15px 40px; font-size: 1.2rem;" onclick="startApp()">INICIAR AN√ÅLISE</button>
    </div>

    <div id="main-app">
        <div id="controls">
            <input type="file" id="map-upload" accept="image/*">
            
            <div class="config-group">
                <label>SLOT:</label>
                <select id="team-select"></select>
                <input type="checkbox" id="slot-visible-toggle" class="slot-visible" checked title="Ativar/Desativar Slot">
            </div>
            
            <div class="config-group">
                <label>üå°Ô∏è HEATMAP:</label>
                <label class="switch">
                    <input type="checkbox" id="heatmap-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <div class="config-group">
                <label>‚ö° BRILHO:</label>
                <input type="color" id="neon-color" value="#00FF00">
                <input type="range" id="neon-brilho" min="10" max="400" value="150">
            </div>

            <div class="config-group">
                <label>üìè TAM. LOGO:</label>
                <input type="range" id="logo-size" min="10" max="150" value="50">
            </div>

            <button class="btn-undo" id="undo-btn">‚Ü©Ô∏è DESFAZER</button>
            <button class="btn-play" id="play-btn">‚ñ∂Ô∏è ANIMAR</button>
            <button class="btn-save" id="save-btn">üì∏ SALVAR</button>
            <button class="btn-clear" id="clear-btn">üóëÔ∏è RESET</button>
        </div>

        <div id="map-container">
            <img id="game-map" src="">
            <canvas id="drawing-canvas"></canvas>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const gameMap = document.getElementById('game-map');
        const teamSelect = document.getElementById('team-select');
        const heatmapToggle = document.getElementById('heatmap-toggle');
        const slotVisibleToggle = document.getElementById('slot-visible-toggle');
        
        let teamData = {}; 
        let teamHistory = {}; 
        let activeTeam = 1;
        let isAnimating = false;
        let animStart;

        function startApp() {
            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
            init();
        }

        function init() {
            for(let i=1; i<=12; i++) {
                teamData[i] = { tag: 'T'+i, neonColor: '#00FF00', size: 50, brilho: 150, visible: true };
                teamHistory[i] = [];
                let opt = document.createElement('option');
                opt.value = i; opt.text = 'Time ' + i;
                teamSelect.add(opt);
            }

            document.getElementById('map-upload').onchange = (e) => {
                const reader = new FileReader();
                reader.onload = (ev) => { gameMap.src = ev.target.result; setTimeout(redraw, 300); };
                reader.readAsDataURL(e.target.files[0]);
            };

            document.getElementById('map-container').onmousedown = (e) => {
                if(isAnimating || !gameMap.src) return;
                const rect = gameMap.getBoundingClientRect();
                const sx = gameMap.naturalWidth / rect.width;
                const sy = gameMap.naturalHeight / rect.height;
                const x = (e.clientX - rect.left) * sx;
                const y = (e.clientY - rect.top) * sy;
                teamHistory[activeTeam].push({ x, y, time: new Date().toLocaleTimeString('pt-BR', {minute:'2-digit', second:'2-digit'}) });
                redraw();
            };

            document.getElementById('undo-btn').onclick = () => { teamHistory[activeTeam].pop(); redraw(); };
            document.getElementById('play-btn').onclick = toggleAnim;
            document.getElementById('clear-btn').onclick = () => location.reload();
            document.getElementById('save-btn').onclick = saveImage;
            
            heatmapToggle.onchange = () => redraw();
            
            slotVisibleToggle.onchange = (e) => {
                teamData[activeTeam].visible = e.target.checked;
                redraw();
            };

            teamSelect.onchange = (e) => { 
                activeTeam = e.target.value; 
                updateUI(); 
            };

            document.getElementById('logo-size').oninput = (e) => { teamData[activeTeam].size = e.target.value; redraw(); };
            document.getElementById('neon-color').oninput = (e) => { teamData[activeTeam].neonColor = e.target.value; redraw(); };
            document.getElementById('neon-brilho').oninput = (e) => { teamData[activeTeam].brilho = e.target.value; redraw(); };
        }

        function updateUI() {
            const t = teamData[activeTeam];
            document.getElementById('logo-size').value = t.size;
            document.getElementById('neon-color').value = t.neonColor;
            document.getElementById('neon-brilho').value = t.brilho;
            slotVisibleToggle.checked = t.visible;
        }

        function drawHeatmap(sx, sy) {
            if (!heatmapToggle.checked) return;
            ctx.save();
            ctx.globalCompositeOperation = 'screen';
            for(let id in teamHistory) {
                // O Heatmap continua aparecendo mesmo que o slot esteja invis√≠vel (An√°lise de calor total)
                teamHistory[id].forEach(p => {
                    const radius = 110 * sx;
                    const grad = ctx.createRadialGradient(p.x*sx, p.y*sy, 0, p.x*sx, p.y*sy, radius);
                    grad.addColorStop(0, 'rgba(255, 255, 255, 0.7)'); 
                    grad.addColorStop(0.15, 'rgba(255, 0, 0, 0.5)');  
                    grad.addColorStop(0.3, 'rgba(255, 165, 0, 0.3)'); 
                    grad.addColorStop(0.5, 'rgba(255, 255, 0, 0.15)'); 
                    grad.addColorStop(0.8, 'rgba(0, 255, 100, 0.05)'); 
                    grad.addColorStop(1, 'rgba(0, 0, 0, 0)');         
                    ctx.fillStyle = grad;
                    ctx.beginPath();
                    ctx.arc(p.x*sx, p.y*sy, radius, 0, Math.PI*2);
                    ctx.fill();
                });
            }
            ctx.restore();
        }

        function redraw(elapsed = null) {
            if(!gameMap.src) return;
            canvas.width = gameMap.clientWidth;
            canvas.height = gameMap.clientHeight;
            const sx = canvas.width / gameMap.naturalWidth;
            const sy = canvas.height / gameMap.naturalHeight;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';

            drawHeatmap(sx, sy);

            for(let id in teamHistory) {
                const config = teamData[id];
                // Pula o desenho se o slot estiver desmarcado
                if(!config.visible) continue;

                const history = teamHistory[id];
                if(history.length < 1) continue;

                ctx.save();
                ctx.beginPath();
                ctx.shadowBlur = config.brilho;
                ctx.shadowColor = config.neonColor;
                ctx.strokeStyle = config.neonColor;
                ctx.lineWidth = 7;
                ctx.lineCap = "round";
                ctx.lineJoin = "round";
                history.forEach((p, i) => { (i === 0) ? ctx.moveTo(p.x*sx, p.y*sy) : ctx.lineTo(p.x*sx, p.y*sy); });
                ctx.stroke();
                
                ctx.shadowBlur = config.brilho / 5;
                ctx.strokeStyle = "#fff";
                ctx.lineWidth = 2.5;
                ctx.stroke();
                ctx.restore();

                if(elapsed !== null) {
                    animateRoute(history, config, elapsed, sx, sy);
                } else {
                    history.forEach(p => drawLogoAt(p.x*sx, p.y*sy, config));
                }
            }
        }

        function drawLogoAt(x, y, t) {
            ctx.save();
            ctx.shadowBlur = t.brilho / 2;
            ctx.shadowColor = t.neonColor;
            ctx.fillStyle = "#fff";
            ctx.beginPath(); ctx.arc(x, y, t.size/2, 0, Math.PI*2); ctx.fill();
            ctx.lineWidth = 3;
            ctx.strokeStyle = t.neonColor;
            ctx.stroke();
            ctx.fillStyle = "#000";
            ctx.font = `bold ${t.size/2.2}px Arial`;
            ctx.textAlign = "center";
            ctx.fillText(t.tag, x, y + (t.size/8));
            ctx.restore();
        }

        function toggleAnim() {
            isAnimating = !isAnimating;
            if(isAnimating) {
                animStart = performance.now();
                requestAnimationFrame(run);
                document.getElementById('play-btn').innerText = "‚èπÔ∏è PARAR";
            } else {
                document.getElementById('play-btn').innerText = "‚ñ∂Ô∏è ANIMAR";
                redraw();
            }
        }

        function run(now) {
            if(!isAnimating) return;
            redraw((now - animStart) / 1000);
            requestAnimationFrame(run);
        }

        function saveImage() {
            const final = document.createElement('canvas');
            const fctx = final.getContext('2d');
            final.width = gameMap.naturalWidth;
            final.height = gameMap.naturalHeight;
            fctx.filter = 'brightness(0.2) contrast(1.3)';
            fctx.drawImage(gameMap, 0, 0);
            fctx.filter = 'none';
            fctx.drawImage(canvas, 0, 0, final.width, final.height);
            const link = document.createElement('a');
            link.download = 'ANALISE_LIPEE_PRO_V10.png';
            link.href = final.toDataURL();
            link.click();
        }
    </script>
</body>
</html>
