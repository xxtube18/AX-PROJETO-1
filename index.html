<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Lipee - Custom Exposure V12</title>
    <style>
        body { background: #050505; margin: 0; font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; }
        
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #111 0%, #000 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999;
        }

        .splash-logo { font-size: 3rem; font-weight: bold; color: #00FF00; text-shadow: 0 0 30px #00FF00; margin-bottom: 10px; text-align: center; }

        #main-app { display: none; flex-direction: column; align-items: center; height: 100vh; padding: 10px; }
        
        #controls {
            background: rgba(15, 15, 15, 0.98); padding: 12px; border-radius: 12px;
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
            border: 1px solid #333; margin-bottom: 10px; width: 98%;
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.1);
        }

        .config-group { background: #1a1a1a; padding: 6px 12px; border-radius: 8px; border: 1px solid #444; display: flex; align-items: center; gap: 8px; font-size: 11px; }

        #map-container { position: relative; border: 2px solid #444; line-height: 0; background: #111; overflow: hidden; cursor: crosshair; }
        #game-map { transition: filter 0.1s; max-width: 100%; max-height: 72vh; }
        #drawing-canvas { position: absolute; top: 0; left: 0; pointer-events: none; }

        button { padding: 10px 15px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 11px; text-transform: uppercase; }
        .btn-play { background: #00FF00; color: #000; box-shadow: 0 0 15px #00FF00; }
        .btn-undo { background: #ffcc00; color: #000; }
        .btn-clear { background: #ff4444; color: #fff; }
        .btn-save { background: #00d4ff; color: #000; }
        
        #legend {
            position: absolute; bottom: 15px; right: 15px; background: rgba(0,0,0,0.85);
            padding: 10px; border-radius: 8px; border: 1px solid #00FF00; display: flex; flex-direction: column; gap: 3px;
        }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 9px; font-weight: bold; color: #fff; }
        .color-box { width: 12px; height: 12px; border: 0.5px solid white; }

        input[type=range] { cursor: pointer; accent-color: #00FF00; }
        input[type=text], select { background: #111; color: #fff; border: 1px solid #444; padding: 5px; border-radius: 4px; font-size: 12px; }
        label { font-weight: bold; color: #00FF00; font-size: 10px; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="splash-logo">COACH LIPEE<br><span style="font-size: 1rem; color: #fff; letter-spacing: 3px;">EXPOSURE CONTROL V12</span></div>
        <button class="btn-play" style="padding: 15px 40px; font-size: 1.2rem;" onclick="startApp()">INICIAR SISTEMA</button>
    </div>

    <div id="main-app">
        <div id="controls">
            <input type="file" id="map-upload" accept="image/*">
            
            <div class="config-group">
                <label>üñºÔ∏è CLAREAR MAPA:</label>
                <input type="range" id="map-brightness" min="10" max="150" value="70">
            </div>

            <div class="config-group">
                <label>SLOT:</label>
                <select id="team-select"></select>
                <input type="checkbox" id="slot-visible-toggle" checked title="Ver Rota">
            </div>
            
            <div class="config-group">
                <label>üå°Ô∏è HEATMAP:</label>
                <input type="checkbox" id="heatmap-toggle" checked>
            </div>

            <div class="config-group">
                <label>‚ö° BRILHO NEON:</label>
                <input type="color" id="neon-color" value="#00FF00">
                <input type="range" id="neon-brilho" min="10" max="400" value="150">
            </div>

            <div class="config-group">
                <label>üìè TAM. LOGO:</label>
                <input type="range" id="logo-size" min="10" max="150" value="50">
            </div>

            <button class="btn-undo" id="undo-btn">‚Ü©Ô∏è</button>
            <button class="btn-play" id="play-btn">‚ñ∂Ô∏è</button>
            <button class="btn-save" id="save-btn">üì∏ SALVAR</button>
            <button class="btn-clear" id="clear-btn">üóëÔ∏è</button>
        </div>

        <div id="map-container">
            <img id="game-map" src="">
            <canvas id="drawing-canvas"></canvas>
            <div id="legend"></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const gameMap = document.getElementById('game-map');
        const teamSelect = document.getElementById('team-select');
        const mapBrightness = document.getElementById('map-brightness');
        const heatmapToggle = document.getElementById('heatmap-toggle');
        const slotVisibleToggle = document.getElementById('slot-visible-toggle');

        const decisColors = {
            1: "#006837", 2: "#1a9850", 3: "#a6d96a", 
            4: "#d9ef8b", 5: "#fee08b", 6: "#fdae61", 
            7: "#f46d43", 8: "#d73027", 9: "#a50026"
        };

        let teamData = {}; 
        let teamHistory = {}; 
        let activeTeam = 1;
        let isAnimating = false;
        let animStart;

        function startApp() {
            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
            createLegend();
            init();
        }

        function createLegend() {
            const legend = document.getElementById('legend');
            for(let i=9; i>=1; i--) {
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `<div class="color-box" style="background:${decisColors[i]}"></div> <span>D${i}</span>`;
                legend.appendChild(item);
            }
        }

        function updateMapFilter() {
            const val = mapBrightness.value / 100;
            gameMap.style.filter = `brightness(${val}) contrast(1.1)`;
        }

        function init() {
            for(let i=1; i<=12; i++) {
                teamData[i] = { tag: 'T'+i, neonColor: '#00FF00', size: 50, brilho: 150, visible: true };
                teamHistory[i] = [];
                let opt = document.createElement('option');
                opt.value = i; opt.text = 'Time ' + i;
                teamSelect.add(opt);
            }

            mapBrightness.oninput = updateMapFilter;
            updateMapFilter();

            document.getElementById('map-upload').onchange = (e) => {
                const reader = new FileReader();
                reader.onload = (ev) => { gameMap.src = ev.target.result; setTimeout(redraw, 300); };
                reader.readAsDataURL(e.target.files[0]);
            };

            document.getElementById('map-container').onmousedown = (e) => {
                if(isAnimating || !gameMap.src) return;
                const rect = gameMap.getBoundingClientRect();
                const sx = gameMap.naturalWidth / rect.width;
                const sy = gameMap.naturalHeight / rect.height;
                const x = (e.clientX - rect.left) * sx;
                const y = (e.clientY - rect.top) * sy;
                teamHistory[activeTeam].push({ x, y });
                redraw();
            };

            document.getElementById('undo-btn').onclick = () => { teamHistory[activeTeam].pop(); redraw(); };
            document.getElementById('play-btn').onclick = toggleAnim;
            document.getElementById('clear-btn').onclick = () => location.reload();
            document.getElementById('save-btn').onclick = saveImage;
            
            heatmapToggle.onchange = redraw;
            slotVisibleToggle.onchange = (e) => { teamData[activeTeam].visible = e.target.checked; redraw(); };
            teamSelect.onchange = (e) => { activeTeam = e.target.value; updateUI(); };
            
            document.getElementById('logo-size').oninput = (e) => { teamData[activeTeam].size = e.target.value; redraw(); };
            document.getElementById('neon-color').oninput = (e) => { teamData[activeTeam].neonColor = e.target.value; redraw(); };
            document.getElementById('neon-brilho').oninput = (e) => { teamData[activeTeam].brilho = e.target.value; redraw(); };
        }

        function updateUI() {
            const t = teamData[activeTeam];
            document.getElementById('logo-size').value = t.size;
            document.getElementById('neon-color').value = t.neonColor;
            document.getElementById('neon-brilho').value = t.brilho;
            slotVisibleToggle.checked = t.visible;
        }

        function drawDecisHeatmap(sx, sy) {
            if (!heatmapToggle.checked) return;
            ctx.save();
            ctx.lineWidth = 0.5;
            ctx.strokeStyle = "white";
            ctx.globalAlpha = 0.8;

            for(let id in teamHistory) {
                const history = teamHistory[id];
                history.forEach((p, index) => {
                    let decisLevel = Math.min(9, Math.ceil((index + 1) / (Math.max(1, history.length / 9))));
                    const radius = 100 * sx;
                    ctx.fillStyle = decisColors[decisLevel];
                    ctx.beginPath();
                    ctx.arc(p.x*sx, p.y*sy, radius, 0, Math.PI*2);
                    ctx.fill();
                    ctx.stroke();
                });
            }
            ctx.restore();
        }

        function redraw(elapsed = null) {
            if(!gameMap.src) return;
            canvas.width = gameMap.clientWidth;
            canvas.height = gameMap.clientHeight;
            const sx = canvas.width / gameMap.naturalWidth;
            const sy = canvas.height / gameMap.naturalHeight;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawDecisHeatmap(sx, sy);

            for(let id in teamHistory) {
                const config = teamData[id];
                if(!config.visible) continue;
                const history = teamHistory[id];
                if(history.length < 1) continue;

                ctx.save();
                ctx.beginPath();
                ctx.shadowBlur = config.brilho;
                ctx.shadowColor = config.neonColor;
                ctx.strokeStyle = config.neonColor;
                ctx.lineWidth = 6;
                ctx.lineCap = "round";
                ctx.lineJoin = "round";
                history.forEach((p, i) => { (i === 0) ? ctx.moveTo(p.x*sx, p.y*sy) : ctx.lineTo(p.x*sx, p.y*sy); });
                ctx.stroke();
                ctx.shadowBlur = 0;
                ctx.strokeStyle = "#fff";
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.restore();

                history.forEach(p => drawLogoAt(p.x*sx, p.y*sy, config));
            }
        }

        function drawLogoAt(x, y, t) {
            ctx.save();
            ctx.shadowBlur = t.brilho / 3;
            ctx.shadowColor = t.neonColor;
            ctx.fillStyle = "#fff";
            ctx.beginPath(); ctx.arc(x, y, t.size/2, 0, Math.PI*2); ctx.fill();
            ctx.lineWidth = 2;
            ctx.strokeStyle = t.neonColor;
            ctx.stroke();
            ctx.fillStyle = "#000";
            ctx.font = `bold ${t.size/2.5}px Arial`;
            ctx.textAlign = "center";
            ctx.fillText(t.tag, x, y + (t.size/8));
            ctx.restore();
        }

        function toggleAnim() {
            isAnimating = !isAnimating;
            if(isAnimating) {
                animStart = performance.now();
                requestAnimationFrame(run);
                document.getElementById('play-btn').innerText = "‚èπÔ∏è";
            } else {
                document.getElementById('play-btn').innerText = "‚ñ∂Ô∏è";
                redraw();
            }
        }

        function run(now) {
            if(!isAnimating) return;
            redraw((now - animStart) / 1000);
            requestAnimationFrame(run);
        }

        function saveImage() {
            const final = document.createElement('canvas');
            const fctx = final.getContext('2d');
            final.width = gameMap.naturalWidth;
            final.height = gameMap.naturalHeight;
            fctx.filter = gameMap.style.filter;
            fctx.drawImage(gameMap, 0, 0);
            fctx.filter = 'none';
            fctx.drawImage(canvas, 0, 0, final.width, final.height);
            const link = document.createElement('a');
            link.download = 'ANALISE_LIPEE_CUSTOM.png';
            link.href = final.toDataURL();
            link.click();
        }
    </script>
</body>
</html>
